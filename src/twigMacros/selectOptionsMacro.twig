{% macro renderOption(field, option) %}
    {% import 'htmlElementMacro.twig' as htmlElementMacro %}

    {% set optionAttributes = option.getAttributes %}

    {% if field.getSelectedValue == option.getValue %}

        {% set optionAttributes = optionAttributes|merge({'selected': 'selected'}) %}

    {% endif %}

    {{ htmlElementMacro.complete('option', optionAttributes, true, option.getText) }}

{% endmacro %}


{% macro renderRecursive(field, optionsOptionGroups) %}
    {% import _self as selectOptionsMacro %}
    {% import 'htmlElementMacro.twig' as htmlElementMacro %}

    {% for optionOptionGroup in optionsOptionGroups %}

        {% if optionOptionGroup.getText %}  {# it is an option not a group #}

            {{ selectOptionsMacro.renderOption(field, optionOptionGroup) }}

        {% else %}  it is an option group

            {{ htmlElementMacro.open('optgroup', optionOptionGroup.getAttributes) }}

            {{ selectOptionsMacro.renderRecursive(field, optionOptionGroup.getOptions) }}

            {{ htmlElementMacro.close('optgroup') }}

        {% endif %}
    {% endfor %}
{% endmacro %}